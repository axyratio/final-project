<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 420px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }
        .icon { font-size: 48px; text-align: center; margin-bottom: 16px; }
        h1 { font-size: 22px; color: #1f2937; text-align: center; margin-bottom: 8px; }
        .subtitle { color: #6b7280; text-align: center; margin-bottom: 24px; font-size: 14px; }
        label { display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 6px; }
        .input-wrapper {
            position: relative;
            margin-bottom: 16px;
        }
        .input-wrapper input {
            width: 100%;
            padding: 12px 44px 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }
        .input-wrapper input:focus { border-color: #7c3aed; }
        .toggle-eye {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #9ca3af;
            padding: 4px;
        }
        .toggle-eye:hover { color: #6b7280; }
        .rules-box { margin-bottom: 16px; display: none; }
        .rule {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            padding: 4px 0;
            transition: color 0.2s;
            color: #9ca3af;
        }
        .rule .icon-status {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            flex-shrink: 0;
            transition: all 0.2s;
            background: #f3f4f6;
            color: #9ca3af;
        }
        .rule.pass { color: #059669; }
        .rule.pass .icon-status { background: #d1fae5; color: #059669; }
        .rule.fail { color: #dc2626; }
        .rule.fail .icon-status { background: #fee2e2; color: #dc2626; }
        .confirm-error {
            color: #dc2626;
            font-size: 13px;
            margin-top: -8px;
            margin-bottom: 12px;
            display: none;
        }
        .server-error {
            background: #fee2e2;
            color: #dc2626;
            font-size: 13px;
            padding: 10px 14px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }
        button.submit-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
        }
        button.submit-btn:hover { opacity: 0.9; }
        button.submit-btn:active { transform: scale(0.98); }
        button.submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .success-card { text-align: center; display: none; }
        .success-card h1 { color: #059669; }
    </style>
</head>
<body>

    <div class="card" id="form-card">
        <div class="icon">üîí</div>
        <h1>‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h1>
        <p class="subtitle">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>

        <div class="server-error" id="server-error"></div>

        <label for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
        <div class="input-wrapper">
            <input type="password" id="password" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" oninput="validate()" />
            <button type="button" class="toggle-eye" onclick="toggleEye('password', this)">üëÅ</button>
        </div>

        <div class="rules-box" id="rules-box">
            <div class="rule" id="r-len"><span class="icon-status">‚Äì</span> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 8‚Äì20 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</div>
            <div class="rule" id="r-upper"><span class="icon-status">‚Äì</span> ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà (A-Z)</div>
            <div class="rule" id="r-lower"><span class="icon-status">‚Äì</span> ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å (a-z)</div>
            <div class="rule" id="r-digit"><span class="icon-status">‚Äì</span> ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (0-9)</div>
            <div class="rule" id="r-special"><span class="icon-status">‚Äì</span> ‡∏°‡∏µ‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏© (!@#$%^&*)</div>
        </div>

        <label for="confirm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
        <div class="input-wrapper">
            <input type="password" id="confirm" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á" oninput="validate()" />
            <button type="button" class="toggle-eye" onclick="toggleEye('confirm', this)">üëÅ</button>
        </div>
        <div class="confirm-error" id="confirm-error"></div>

        <button class="submit-btn" id="submit-btn" onclick="handleSubmit()">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
    </div>

    <div class="card success-card" id="success-card">
        <div class="icon">‚úÖ</div>
        <h1>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h1>
        <p class="subtitle">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß</p>
    </div>

    <script>
        function toggleEye(inputId, btn) {{
            const input = document.getElementById(inputId);
            if (input.type === 'password') {{
                input.type = 'text';
                btn.textContent = 'üôà';
            }} else {{
                input.type = 'password';
                btn.textContent = 'üëÅ';
            }}
        }}

        function validate() {{
            const pw = document.getElementById('password').value;
            const cf = document.getElementById('confirm').value;
            const box = document.getElementById('rules-box');
            const confirmErr = document.getElementById('confirm-error');

            box.style.display = pw.length > 0 ? 'block' : 'none';

            const rules = [
                { id: 'r-len',     test: pw.length >= 8 && pw.length <= 20 },
                { id: 'r-upper',   test: /[A-Z]/.test(pw) },
                { id: 'r-lower',   test: /[a-z]/.test(pw) },
                { id: 'r-digit',   test: /[0-9]/.test(pw) },
                { id: 'r-special', test: /[!@#$%^&*]/.test(pw) },
            ];

            rules.forEach(r => {{
                const el = document.getElementById(r.id);
                const icon = el.querySelector('.icon-status');
                if (r.test) {{
                    el.className = 'rule pass';
                    icon.textContent = '‚úì';
                }} else {{
                    el.className = 'rule fail';
                    icon.textContent = '‚úó';
                }}
            }});

            if (cf.length > 0 && pw !== cf) {{
                confirmErr.textContent = '‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô';
                confirmErr.style.display = 'block';
                confirmErr.style.color = '#dc2626';
            }} else if (cf.length > 0 && pw === cf) {{
                confirmErr.textContent = '‚úÖ ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô';
                confirmErr.style.display = 'block';
                confirmErr.style.color = '#059669';
            }} else {{
                confirmErr.style.display = 'none';
            }}
        }}

        function allRulesPass() {{
            const pw = document.getElementById('password').value;
            const cf = document.getElementById('confirm').value;
            if (pw.length < 8 || pw.length > 20) return false;
            if (!/[A-Z]/.test(pw)) return false;
            if (!/[a-z]/.test(pw)) return false;
            if (!/[0-9]/.test(pw)) return false;
            if (!/[!@#$%^&*]/.test(pw)) return false;
            if (!cf || pw !== cf) return false;
            return true;
        }}

        async function handleSubmit() {{
            const password = document.getElementById('password').value;
            const btn = document.getElementById('submit-btn');
            const serverErr = document.getElementById('server-error');

            serverErr.style.display = 'none';
            validate();

            if (!allRulesPass()) {{
                document.getElementById('rules-box').style.display = 'block';
                return;
            }}

            btn.disabled = true;
            btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...';

            try {{
                const res = await fetch('/auth/reset-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: '{token}', new_password: password })
                });
                const data = await res.json();

                if (data.success) {{
                    document.getElementById('form-card').style.display = 'none';
                    document.getElementById('success-card').style.display = 'block';
                }} else {{
                    serverErr.textContent = data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
                    serverErr.style.display = 'block';
                    btn.disabled = false;
                    btn.textContent = '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô';
                }}
            }} catch (err) {{
                serverErr.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
                serverErr.style.display = 'block';
                btn.disabled = false;
                btn.textContent = '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô';
            }}
        }}
    </script>

</body>
</html>